
[[publishing_portal]]
= Publishing Plugins to the Gradle Plugin Portal
:portal: Gradle Plugin Portal
:plugin: Greeting Plugin
:publishplugin: Plugin Publishing Plugin
:plugin-reference-documentation: https://plugins.gradle.org/docs/publish-plugin[reference documentation of the {publishplugin}]

Publishing a plugin is the main way to make it available for others to use.
One approach is to publish the plugin to a private repository, which is common when you want to restrict who can use it.
But if you want the plugin to be available to anyone in the world, i.e.
public, then you should publish it to the https://plugins.gradle.org[{portal}], a centralized, searchable repository dedicated to Gradle plugins.

This section will show you how to use the https://plugins.gradle.org/plugin/com.gradle.plugin-publish[{publishplugin}] to publish plugins to the {portal} using a convenient DSL.
Taking this approach eliminates a large number of configuration steps and provides a number of checks to validate that your plugin meets the criteria enforced by the {portal}.

== Start with an existing Gradle plugin project

You will need an existing plugin project for this tutorial.
If you don't have your own, you may use the link:../samples/sample_gradle_plugin.html[Greeting plugin sample].

Don't worry about cluttering up the {portal} with a trivial example plugin: trying to publish this plugin will safely fail with a permission error.

== Create an account on the {portal}

If you have never published a plugin to the {portal} before, you first need to create an account there.
This consists of three steps:

. Create an account
. Create an API key
. Add your API key to your Gradle configuration

Start by going to the https://plugins.gradle.org/user/register[registration page] — which looks like the image below – and creating an account.

.Registration page
image::plugin-portal-registration-page.png[]

Follow the instructions on that page.
Once you have logged in, you can get your API key via the "API Keys" tab of your profile page.

.API keys is the third tab
image::plugin-portal-api-keys.png[]

It is common practice to copy and paste the text into your <<build_environment.adoc#sec:gradle_configuration_properties,$HOME/.gradle/gradle.properties>> file, but you can also place it in any other valid location.
All that the plugin requires is that `gradle.publish.key` and `gradle.publish.secret` are available as project properties when the appropriate Plugin Portal tasks are executed.

If you are concerned about placing your credentials in `gradle.properties`, investigate use of
https://plugins.gradle.org/plugin/de.qaware.seu.as.code.credentials[Seauc Credentials plugin] or the
https://plugins.gradle.org/plugin/nu.studer.credentials[Gradle Credentials plugin].

Once you have the API key you can publish as many plugins as you like.

[[plugin-publishing-plugin]]
== Add the {publishplugin} to the project

Add the {publishplugin} to the `plugins` block.

====
include::sample[dir="snippets/developingPlugins/publishingPlugins/groovy",files="build.gradle[tags=plugins_block]"]
include::sample[dir="snippets/developingPlugins/publishingPlugins/kotlin",files="build.gradle.kts[tags=plugins_block]"]
====
The latest version of the {publishplugin} can be found on the https://plugins.gradle.org/plugin/com.gradle.plugin-publish[{portal}].

NOTE: Since version 1.0.0 the Plugin Publish Plugin automatically applies the
<<java_gradle_plugin.adoc#java_gradle_plugin,Java Gradle Plugin Development Plugin>> (assists in developing Gradle plugins) and the
<<publishing_maven.adoc#publishing_maven, Maven Publish Plugin>> (generates plugin publication metadata).
If using older versions of the Plugin Publish Plugin, these helper plugins need to be applied explicitly.


== Configure the {publishplugin}

First specify information applicable to all the plugins published by your build (we call this your "plugin bundle"; it is also
possible to set specific properties on a per-plugin basis, more on that later). This helps other people browsing the portal find
more information about your plugin and learn how to contribute to its development.

====
include::sample[dir="snippets/developingPlugins/publishingPlugins/groovy",files="build.gradle[tags=plugin_bundle]"]
include::sample[dir="snippets/developingPlugins/publishingPlugins/kotlin",files="build.gradle.kts[tags=plugin_bundle]"]
====
<1> Make sure your project has a `group` set which is used for the artifacts (jar and metadata) you publish for your bundle in the repository of the {portal}
and which is descriptive of the plugin author or the organization the plugin belongs too.
<2> Set the version for your next bundle publication. You need to increase the version, if you already published these plugins before.
<3> Set the website for your plugin's project.
<4> Provide the source repository URI so that others can find it if they want to contribute.
<5> Set the human-readable description for all plugins in your bundle.
<6> Set the tags to be used for all plugins in your bundle.

Now define specific details for each plugin in your bundle. The most important part is the `id` property, as that both uniquely
identifies the plugin on the {portal} and prevents namespace clashes between different plugin authors.

NOTE: If you would like to associate your plugin with a particular organization, you also set the ID based on that organization’s domain using the
reverse-domain pattern used for Java packages, for example `org.example.greeting`. If the plugin doesn't belong to any specific organization,
then the plugin ID should be associated with the author, for example by using the author's GitHub ID in a reverse domain pattern, like `io.github.johndoe`.
Remember that the plugin id and project group should match, i.e. have the same top level namespace.

====
include::sample[dir="snippets/developingPlugins/publishingPlugins/groovy",files="build.gradle[tags=gradle-plugin]"]
include::sample[dir="snippets/developingPlugins/publishingPlugins/kotlin",files="build.gradle.kts[tags=gradle-plugin]"]
====
<1> Each plugin in a bundle will have its own block inside `plugins`.
<2> The name of a plugin block needs to be unique for each plugin in the bundle; this is a property used only locally by your build and will not be part of the publication.
<3> Set the unique `id` of the plugin, as it will be identified in the publication.
<4> Set the plugin name in human-readable form.
<5> Set a description to be displayed on the portal. It provides useful information to people who might want to use your plugin.
    Overrides the description provided at the plugin bundle level.
<6> Specifies the categories your plugin covers. Makes the plugin more likely to be discovered by people needing its functionality.
    Overrides any tags provided at the plugin bundle level.

NOTE: The ability to specify custom tags per plugin was only added in Gradle 7.5. When using an older version of Gradle the same result
can be achieved by using the `pluginTags` map in the `pluginBundle` block. Please refer to the {plugin-reference-documentation} for an example.

As an example consider the configuration for the https://plugins.gradle.org/plugin/org.ysb33r.gradletest[GradleTest plugin], which is already published to the {portal}.

.build.gradle
[source.multi-language-sample,groovy]
----
pluginBundle {
    website = 'https://github.com/ysb33r/gradleTest'
    vcsUrl = 'https://github.com/ysb33r/gradleTest.git'
}
gradlePlugin {
    plugins {
        gradletestPlugin {
            id = 'org.ysb33r.gradletest'
            displayName = 'Plugin for compatibility testing of Gradle plugins'
            description = 'A plugin that helps you test your plugin against a variety of Gradle versions'
            tags = ['testing', 'integrationTesting', 'compatibility']
            implementationClass = 'org.ysb33r.gradle.gradletest.GradleTestPlugin'
        }
    }
}
----
.build.gradle.kts
[source.multi-language-sample,kotlin]
----
pluginBundle {
    website = "https://github.com/ysb33r/gradleTest"
    vcsUrl = "https://github.com/ysb33r/gradleTest.git"
}
gradlePlugin {
    plugins {
        create("gradletestPlugin") {
            id = "org.ysb33r.gradletest"
            displayName = "Plugin for compatibility testing of Gradle plugins"
            description = "A plugin that helps you test your plugin against a variety of Gradle versions"
            tags = listOf("testing", "integrationTesting", "compatibility")
            implementationClass = "org.ysb33r.gradle.gradletest.GradleTestPlugin"
        }
    }
}
----

If you browse the associated page on the {portal} for the https://plugins.gradle.org/plugin/org.ysb33r.gradletest[GradleTest plugin], you will see how the specified metadata is displayed.

.GradleTest plugin metadata on the {portal}
image::plugin-portal-plugin-page.png[]

=== Sign artifacts ===

Starting from version 1.0.0 of Plugin Publish Plugin, signing of published plugin artifacts has been made automatic. To enable it, all that's needed is to apply the <<signing_plugin.adoc,`signing`>> plugin in your build.

=== Shadow dependencies ===

Starting from version 1.0.0 of Plugin Publish Plugin, shadowing the dependencies of your plugin (ie. publishing it as a fat jar) has been made automatic. To enable it, all that's needed is to apply the https://github.com/johnrengelman/shadow[`com.github.johnrengelman.shadow`] plugin in your build.

[[custom-plugin-repositories]]
== Publish your plugin to a local repository

To check how the artifacts of your published plugin look, or to use it only locally or internal in your company, you can publish it to any maven repository, including a local folder.
For that, you only need to <<publishing_maven.adoc#publishing_maven:repositories,configure repositories for publishing>>.
Then you can run the `publish` task to publish your plugin to all repositories you have defined (but not the {portal}).

====
include::sample[dir="snippets/developingPlugins/publishingPlugins/groovy",files="build.gradle[tags=local_repository]"]
include::sample[dir="snippets/developingPlugins/publishingPlugins/kotlin",files="build.gradle.kts[tags=local_repository]"]
====

To use the repository in another build, you have to add it to <<plugins.adoc#sec:custom_plugin_repositories,the repositories of the `pluginManagement {}` block>> in your `settings.gradle(.kts)` file.

== Publish your plugin to the Plugin Portal

Publish the plugin by using the `publishPlugin` task.

[listing]
----
$ ./gradlew publishPlugins
----

If you have not configured your {portal} key and secret values in your `gradle.properties` file, you can specify them on the command-line

[listing]
----
$ ./gradlew publishPlugins -Pgradle.publish.key=<key> -Pgradle.publish.secret=<secret>
----

NOTE: If you attempt to publish the example Greeting Plugin with the ID used in this section, you will encounter a permission failure.
That's expected and ensures that the portal won't be overrun with multiple experimental and duplicate greeting-type plugins.


[[consume]]
== Consume the published plugin

If your plugin is successfully published, you'll be able to find instructions for its use at a URL of the form *+https://plugins.gradle.org/plugin/<your-plugin-id>+*.
For example, the Greeting Plugin example is already on the portal at https://plugins.gradle.org/plugin/org.example.greeting.

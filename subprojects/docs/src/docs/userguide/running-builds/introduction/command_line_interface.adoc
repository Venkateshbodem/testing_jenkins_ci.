// Copyright 2023 the original author or authors.
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//      http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

[[command_line_interface]]
= Gradle Command-Line Interface

The command-line interface is the **primary method of interacting with Gradle**.

The following is a reference for executing and customizing the Gradle command-line.
It also serves as a reference when writing scripts or configuring continuous integration.

**Use of the <<gradle_wrapper.adoc#gradle_wrapper, Gradle Wrapper>> is highly encouraged**.
Substitute `./gradlew` (in macOS / Linux) or `gradlew.bat` (in Windows) for `gradle` in the following examples.

Executing Gradle on the command-line conforms to the following structure:

----
gradle [taskName...] [--option-name...]
----

Options are allowed _before_ and _after_ task names.

----
gradle [--option-name...] [taskName...]
----

If multiple tasks are specified, you should separate them with a space.

----
gradle [taskName1 taskName2...] [--option-name...]
----

Options that accept values can be specified with or without `=` between the option and argument. The use of `=` is recommended.

----
gradle [...] --console=plain
----

Options that enable behavior have long-form options with inverses specified with `--no-`. The following are opposites.

----
gradle [...] --build-cache
gradle [...] --no-build-cache
----

Many long-form options have short-option equivalents. The following are equivalent:

----
gradle --help
gradle -h
----

[NOTE]
====
Many command-line flags can be specified in `gradle.properties` to avoid needing to be typed.
See the <<build_environment.adoc#sec:gradle_configuration_properties, Configuring build environment guide>> for details.
====

== Command-line usage

The following sections describe the use of the Gradle command-line interface.

Some plugins also add their own command line options.
For example, `--tests`, which is added by <<java_testing.adoc#test_filtering,Java test filtering>>.
For more information on exposing command line options for your own tasks, see <<custom_tasks.adoc#sec:declaring_and_using_command_line_options,Declaring command-line options>>.

[[sec:command_line_executing_tasks]]
=== Executing tasks
You can learn about what projects and tasks are available in the <<#sec:command_line_project_reporting, project reporting section>>.

Most builds support a common set of tasks known as <<more_about_tasks#sec:lifecycle_tasks,_lifecycle tasks_>>. These include the `build`, `assemble`, and `check` tasks.

To execute a task called `myTask` on the root project, type:

----
$ gradle :myTask
----

This will run the single `myTask` and all of its <<writing_tasks.adoc#sec:task_dependencies,dependencies>>.

[[sec:disambiguate_task_options_from_built_in_options]]
=== Specify options for tasks
To pass an option to a task, prefix the option name with `--` after the task name:

----
$ gradle exampleTask --exampleOption=exampleValue
----

==== Disambiguate task options from built-in options
Gradle does not prevent tasks from registering options that conflict with Gradle's built-in options, like `--profile` or `--help`.

You can fix conflicting task options from Gradle's built-in options with a `--` delimiter before the task name in the command:

----
$ gradle [--built-in-option-name...] -- [taskName...] [--task-option-name...]
----

Consider a task named `mytask` that accepts an option named `profile`:

- In `gradle mytask --profile`, Gradle accepts `--profile` as the built-in Gradle option.

- In `gradle \-- mytask --profile=value`, Gradle passes `--profile` as a task option.

[[executing_tasks_in_multi_project_builds]]
=== Executing tasks in multi-project builds
In a <<intro_multi_project_builds.adoc#intro_multi_project_builds, multi-project build>>, subproject tasks can be executed with `:` separating the subproject name and task name.
The following are equivalent when _run from the root project_:

----
$ gradle :subproject:taskName
----

----
$ gradle subproject:taskName
----

You can also run a task for _all_ subprojects using a task _selector_ that consists of only the task name.

The following command runs the `test` task for all subprojects when invoked from the _root project directory_:

----
$ gradle test
----

[NOTE]
====
Some tasks selectors, like `help` or `dependencies`, will only run the task on the project they are invoked on and not on all the subprojects.
====

When invoking Gradle from within a subproject, the project name should be omitted:

----
$ cd subproject
----
----
$ gradle taskName
----

[TIP]
====
When executing the Gradle Wrapper from a subproject directory, reference `gradlew` relatively. For example: `../gradlew taskName`.
====

=== Executing multiple tasks
You can also specify multiple tasks.
The tasks' dependencies determine the precise order of execution, and a task having no dependencies may execute earlier than it is listed on the command-line.

For example, the following will execute the `test` and `deploy` tasks in the order that they are listed on the command-line and will also execute the dependencies for each task.

----
$ gradle test deploy
----

=== Command line order safety
Although Gradle will always attempt to execute the build quickly, command line ordering safety will also be honored.

For example, the following will
execute `clean` and `build` along with their dependencies:

----
$ gradle clean build
----

However, the intention implied in the command line order is that `clean` should run first and then `build`. It would be incorrect to execute `clean` _after_ `build`, even if doing so would cause the build to execute faster since `clean` would remove what `build` created.

Conversely, if the command line order was `build` followed by `clean`, it would not be correct to execute `clean` before `build`. Although Gradle will execute the build as quickly as possible, it will also respect the safety of the order of tasks specified on the command line and ensure that `clean` runs before `build` when specified in that order.

Note that <<incremental_build.adoc#incremental_build,command line order safety>> relies on tasks properly declaring what they create, consume, or remove.

[[sec:excluding_tasks_from_the_command_line]]
=== Excluding tasks from execution
You can exclude a task from being executed using the `-x` or `--exclude-task` command-line option and providing the name of the task to exclude:

----
$ gradle dist --exclude-task test
----
----
include::{snippetsPath}/tutorial/excludeTasks/tests/excludeTask.out[]
----

image::commandLineTutorialTasks.png[]

You can see that the `test` task is not executed, even though it depends on the `dist` task. The `test` task's dependencies, such as `compileTest`, are not executed either. Those dependencies of `test` that another task requires, such as `compile`, are still executed.

[[sec:rerun_tasks]]
=== Forcing tasks to execute
You can force Gradle to execute all tasks ignoring <<incremental_build.adoc#incremental_build,up-to-date checks>> using the `--rerun-tasks` option:

----
$ gradle test --rerun-tasks
----

This will force `test` and _all_ task dependencies of `test` to execute. It is similar to running `gradle clean test`, but without the build's generated output being deleted.

Alternatively, you can tell Gradle to rerun a specific task using the `--rerun` built-in <<#sec:task_options, task option>>.

[[sec:continue_build_on_failure]]
=== Continue the build after a task failure
By default, Gradle aborts execution and fails the build when any task fails.
This allows the build to complete sooner and prevents cascading failures from obfuscating the root cause of an error.

You can use the `--continue` option to force Gradle to execute every task when a failure occurs:

----
$ gradle test --continue
----

When executed with `--continue`, Gradle executes _every_ task in the build if all the dependencies for that task are completed without failure.

For example, tests do not run if there is a compilation error in the code under test because the `test` task depends on the `compilation` task.
Gradle outputs each of the encountered failures at the end of the build.

[NOTE]
====
If any tests fail, many test suites fail the entire `test` task.
Code coverage and reporting tools frequently run after the test task, so "fail fast" behavior may halt execution before those tools run.
====

[[sec:name_abbreviation]]
=== Name abbreviation
When you specify tasks on the command-line, you don't have to provide the full name of the task.
You can provide enough of the task name to identify the task uniquely.
For example, it is likely `gradle che` is enough for Gradle to identify the `check` task.

The same applies to project names. You can execute the `check` task in the `library` subproject with the `gradle lib:che` command.

You can use https://en.wikipedia.org/wiki/Camel_case[camel case] patterns for more complex abbreviations. These patterns are expanded to match camel case and https://en.wikipedia.org/wiki/Kebab_case[kebab case] names.
For example, the pattern `foBa` (or `fB`) matches `fooBar` and `foo-bar`.

More concretely, you can run the `compileTest` task in the `my-awesome-library` subproject with the command `gradle mAL:cT`.

----
$ gradle mAL:cT
----
----
include::{snippetsPath}/tutorial/nameMatching/tests/nameMatching.out[]
----

Abbreviations can also be used with the `-x` command-line option.

=== Tracing name expansion
For complex projects, it might be ambiguous if the intended tasks were executed. When using abbreviated names, a single typo can lead to the execution of unexpected tasks.

When `INFO`, or more <<logging.adoc#logLevels,verbose logging>> is enabled, the output will contain extra information about the project and task name expansion.

For example, when executing the `mAL:cT` command on the previous example, the following log messages will be visible:

----
No exact project with name ':mAL' has been found. Checking for abbreviated names.
Found exactly one project that matches the abbreviated name ':mAL': ':my-awesome-library'.
No exact task with name ':cT' has been found. Checking for abbreviated names.
Found exactly one task name, that matches the abbreviated name ':cT': ':compileTest'.
----

== Common tasks

The following are task conventions applied by built-in and most major Gradle plugins.

=== Computing all outputs
It is common in Gradle builds for the `build` task to designate assembling all outputs and running all checks:

----
$ gradle build
----

=== Running applications
It is common for applications to run with the `run` task, which assembles the application and executes some script or binary:

----
$ gradle run
----

=== Running all checks
It is common for _all_ verification tasks, including tests and linting, to be executed using the `check` task:

----
$ gradle check
----

=== Cleaning outputs
You can delete the contents of the build directory using the `clean` task. Doing so will cause pre-computed outputs to be lost, causing significant additional build time for the subsequent task execution:

----
$ gradle clean
----

[[sec:command_line_project_reporting]]
== Project reporting

Gradle provides several built-in tasks which show particular details of your build.
This can be useful for understanding your build's structure and dependencies, as well as debugging problems.

=== Listing projects
Running the `projects` task gives you a list of the subprojects of the selected project, displayed in a hierarchy:

----
$ gradle projects
----

You also get a project report within https://scans.gradle.com/[Build Scans].

[[sec:listing_tasks]]
=== Listing tasks
Running `gradle tasks` gives you a list of the main tasks of the selected project. This report shows the default tasks for the project, if any, and a description for each task:

----
$ gradle tasks
----

By default, this report shows only those tasks assigned to a task group.

Groups (such as verification, publishing, help, build...) are available as the header of each section when listing tasks:

----
> Task :tasks

Build tasks
-----------
assemble - Assembles the outputs of this project.

Build Setup tasks
-----------------
init - Initializes a new Gradle build.

Distribution tasks
------------------
assembleDist - Assembles the main distributions

Documentation tasks
-------------------
javadoc - Generates Javadoc API documentation for the main source code.
----

You can obtain more information in the task listing using the `--all` option:

----
$ gradle tasks --all
----
